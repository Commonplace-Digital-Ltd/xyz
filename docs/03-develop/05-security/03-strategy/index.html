<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="/icons/favicon.ico">
  <title>Strategy</title>
  <style>

    body {
      margin: 0;
      padding: 0;
    }

    .grid {
      font-family: system-ui;
      display:grid;
      grid-template-columns: 1fr 5fr;
      max-width: 1100px;
      margin: auto;
      padding: 0 30px;
    }

    #toggle {
        display: none;
    }

    #toggle:hover {
      cursor: pointer;
    }

    #nav {
      grid-column: 1;
      padding-inline-start: 0px;
      list-style-type: none;
      padding-right: 20px;
      margin: 10px 0;
    }

    #nav > *:first-child {
      line-height: 1;
    }

    #content {
      grid-column: 2;
      padding-left: 20px;
      border-left: 1px solid #ddd;
      margin: 10px 0;
    }

    #content > *:first-child {
      margin: 0;
    }

    .active {
      font-weight: bold;
    }

    a {
      text-decoration: none;
      white-space: nowrap;
      color: #333;
    }

    h1, h2, h3 {
      margin-bottom: 0.5em;
    }

    p {
      margin-top: 0.5em;
      line-height: 1.5;
    }

    li {
      line-height: 1.5;
    }

    li._1 {
      padding-left: 0px;
    }

    li._2 {
      padding-left: 20px;
    }

    li.__2 {
      padding-left: 0px;
    }

    li._3 {
      padding-left: 40px;
    }

    li.__3 {
      padding-left: 20px;
    }

    pre {
      display: block;
      font-family: monospace;
      white-space: pre;
      margin: 1em 0;
      padding: 15px;
      box-shadow: 0 0 2px #555;
      overflow-x: auto;
      background-color: #f0f0f0;
    }

    code {
      font-family: monospace;
      background-color: #f0f0f0;
    }

    *:not(pre) > code {
      padding: 5px;
    }

    #content a {
      color: #090;
    }

    #content img {
      max-width: 100%;
      display: block;
      margin: 0 auto;
    }

    @media only screen and (max-width: 700px) {
      .grid {
        grid-template-columns: 0 1fr;
        padding: 0 0 0 40px;
      }

      #toggle {
        display: block;
        position: fixed;
        top: 10px;
        left: 10px;        
        width: 20px;
        height: 30px;
        background: repeating-linear-gradient(#ddd, #fff 10px);
      }

      #nav {
        display: none;
      }

      #content {
        border-left: none;
        padding: 0 20px 0 1px;
        overflow: hidden;
      }
    }

    .show_nav {
      grid-template-columns: 1fr 2fr;
    }

    .show_nav > #nav {
      display: block;
    }

    .show_nav > #content * {
      font-size: 30%;
      padding: 0;
      overflow: hidden;
    }
  </style>

</head>

<body>

  <div class="grid">

    <div id="toggle"></div>

    <ul id="nav">

      <li>
        <a style="font-weight: bold; font-size: 30px;" href="https://geolytix.github.io/xyz/docs">XYZ</a>
      </li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <li class="_1 __1 ">
        <a href="https://geolytix.github.io/xyz/docs/03-develop/00-infrastructure/">Develop</a>
      </li>
      
      
      
      <li class="_1  ">
        <a href="https://geolytix.github.io/xyz/docs/03-develop/01-client/">Client</a>
      </li>
      
      
      
      <li class="_1  ">
        <a href="https://geolytix.github.io/xyz/docs/03-develop/02-server/">Server</a>
      </li>
      
      
      
      <li class="_2 __2 ">
        <a href="https://geolytix.github.io/xyz/docs/03-develop/04-dependencies/00-introduction/">Introduction</a>
      </li>
      
      
      
      <li class="_2  ">
        <a href="https://geolytix.github.io/xyz/docs/03-develop/04-dependencies/01-sass/">Sass</a>
      </li>
      
      
      
      <li class="_2  ">
        <a href="https://geolytix.github.io/xyz/docs/03-develop/04-dependencies/02-web-pack/">Webpack</a>
      </li>
      
      
      
      <li class="_2 __2 ">
        <a href="https://geolytix.github.io/xyz/docs/03-develop/05-security/00-security/">Security</a>
      </li>
      
      
      
      <li class="_2  ">
        <a href="https://geolytix.github.io/xyz/docs/03-develop/05-security/01-jwt-token/">JWT Token</a>
      </li>
      
      
      
      <li class="_2  ">
        <a href="https://geolytix.github.io/xyz/docs/03-develop/05-security/02-sql-injections/">SQL injections</a>
      </li>
      
      
      
      <li class="_2  active">
        <a href="https://geolytix.github.io/xyz/docs/03-develop/05-security/03-strategy/">Strategy</a>
      </li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      

    </ul>

    <div id="content">
      <p>__<a href="https://github.com/fastify/fastify-auth"><em>fastify-auth</em></a> which is used to decorate XYZ routes does not provide an authentication strategy. The strategy applied by the XYZ authToken module will detailed here.</p>
<p>Public endpoints are immediately resolved.</p>
<p>Private endpoints with a missing token will resolve in a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401">401</a> or redirect to the login form.</p>
<p>Thereafter the signiture of the token will be verified. Failing to verify signature will resolve in a 401 or redirect.</p>
<p>Missing an email field in the decoded token with resolve in a 401 or redirect.</p>
<p>API token (which do not expire) are checked against the ACL. The token must match the token stored with the user account in the ACL. Failing to do so reolves in a 401 (no redirect).</p>
<p>Valid API token are internally replaced with a PRIVATE access token which expires in 10 seconds.</p>
<p>Admin level token are checked last. Routes which require administrative access will resolve in a 401 or redirect if the token has insufficient access privileges.</p>
<ol>
<li>
<p><strong>decode token</strong></p>
<p>If exists a user token will be decoded from the request cookie or request parameter (in case the request is generated without the capability to assign cookies).</p>
</li>
<li>
<p><strong>no token</strong></p>
<p>Fail. <em>No user token found in request.</em> Authentication will fail if no decoded token exists at this stage. An anonymous user token and a session token with the request URL as redirect will be signed to the response.</p>
</li>
<li>
<p><strong>token timeout</strong></p>
<p>Fail. <em>Session timeout.</em> The time from when the token was issued at (iat) is compared to the current time to establish the token's age. The authentication will fail if the token's age exceeds the timeout limit.</p>
</li>
<li>
<p><strong>no admin</strong></p>
<p>Fail. <em>Admin authorization required for the requested route.</em> This stage is only checked for requests to endpoints which require admin level authorization. Authorization will fail if the user token does not carry admin privileges.</p>
</li>
<li>
<p><strong>no email</strong></p>
<p>Fail. <em>Email not defined in token.</em> Authorization will fail at this stage if the user token does not carry an email field in the payload.</p>
</li>
<li>
<p><strong>user not verified</strong></p>
<p>Fail. <em>User email not verified.</em> Authorization will fail if the user token does not carry information that the account email has been verified.</p>
</li>
<li>
<p><strong>user not approved</strong></p>
<p>Fail. <em>User email not approved by administrator.</em> Authorization will fail at this stage if the user token does not carry the <em>approved</em> field.</p>
</li>
<li>
<p><strong>issue new token</strong></p>
<p>Success. Authorization has completed and the user token's issue at value (iat) is updated with the current time, signed to the response, and finally passed on to the <em>done()</em> callback.</p>
</li>
</ol>

    </div>

  </div>

</body>

<script>
    const toggle = document.getElementById('toggle');

    toggle.onclick = e => { e.target.parentElement.classList.toggle('show_nav'); };
</script>

</html>